<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SnakeIO Advanced - –ü–∞—Äodi —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –º–µ—Ö–∞–Ω–∏–∫–æ–π</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #00ff88;
        }

        .container {
            width: 95%;
            max-width: 1200px;
            background: rgba(20, 20, 40, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
            border: 2px solid #00ff88;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #00ff88;
            padding-bottom: 15px;
        }

        .header h1 {
            font-size: 2.5em;
            text-shadow: 0 0 10px #00ff88;
            margin-bottom: 5px;
        }

        .header p {
            color: #00ccff;
            font-size: 0.9em;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .game-section {
            display: flex;
            flex-direction: column;
        }

        #gameCanvas {
            background: #0a0a1a;
            border: 3px solid #00ff88;
            border-radius: 10px;
            display: block;
            margin: 0 auto;
            max-width: 100%;
            height: auto;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }

        .game-info {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .info-box {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .info-box label {
            display: block;
            font-size: 0.8em;
            color: #00ccff;
            margin-bottom: 5px;
        }

        .info-box .value {
            font-size: 1.5em;
            font-weight: bold;
            color: #00ff88;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel {
            background: rgba(0, 255, 136, 0.05);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 15px;
        }

        .panel h3 {
            color: #00ccff;
            margin-bottom: 10px;
            font-size: 1.1em;
            border-bottom: 1px solid #00ff88;
            padding-bottom: 8px;
        }

        .controls-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        button {
            background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
            border: none;
            color: #0a0a1a;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9em;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.6);
        }

        button:active {
            transform: scale(0.95);
        }

        button.secondary {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid #00ff88;
        }

        button.secondary:hover {
            background: rgba(0, 255, 136, 0.4);
        }

        .cheats-panel {
            max-height: 400px;
            overflow-y: auto;
        }

        .cheat-item {
            background: rgba(0, 100, 255, 0.1);
            border-left: 3px solid #0064ff;
            padding: 10px;
            margin: 8px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .cheat-item:hover {
            background: rgba(0, 100, 255, 0.2);
            transform: translateX(5px);
        }

        .cheat-item.active {
            background: rgba(0, 255, 136, 0.2);
            border-left-color: #00ff88;
        }

        .cheat-item label {
            display: flex;
            align-items: center;
            cursor: pointer;
            gap: 10px;
            margin: 0;
        }

        .cheat-item input[type="checkbox"] {
            cursor: pointer;
            width: 18px;
            height: 18px;
        }

        .cheat-item input[type="number"],
        .cheat-item input[type="range"] {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            color: #00ff88;
            padding: 5px;
            border-radius: 4px;
            margin-top: 5px;
            width: 100%;
            font-family: monospace;
        }

        .cheat-item input[type="range"] {
            padding: 0;
            height: 6px;
        }

        .cheat-description {
            font-size: 0.75em;
            color: #00ccff;
            margin-top: 3px;
            font-style: italic;
        }

        .stats-panel {
            font-size: 0.9em;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #00ccff;
        }

        .stat-value {
            color: #00ff88;
            font-weight: bold;
        }

        .controls-info {
            font-size: 0.85em;
            color: #00ccff;
            line-height: 1.6;
        }

        .controls-info strong {
            color: #00ff88;
        }

        .footer {
            text-align: center;
            padding-top: 15px;
            border-top: 2px solid #00ff88;
            color: #00ccff;
            font-size: 0.85em;
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            .game-info {
                grid-template-columns: 1fr 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a2e;
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
        }

        .modal-content h2 {
            font-size: 2em;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #00ff88;
        }

        .modal-content p {
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #00ccff;
        }

        .difficulty-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêç SnakeIO Advanced</h1>
            <p>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –ø–∞—Äo–¥–∏—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –∏–≥—Ä—ã —Å —á–∏—Ç–∞–º–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∫–æ–π</p>
        </div>

        <div class="main-layout">
            <div class="game-section">
                <canvas id="gameCanvas" width="800" height="500"></canvas>
                
                <div class="game-info">
                    <div class="info-box">
                        <label>–°—á–µ—Ç</label>
                        <div class="value" id="score">0</div>
                    </div>
                    <div class="info-box">
                        <label>–î–ª–∏–Ω–∞</label>
                        <div class="value" id="length">3</div>
                    </div>
                    <div class="info-box">
                        <label>–£—Ä–æ–≤–µ–Ω—å</label>
                        <div class="value" id="level">1</div>
                    </div>
                    <div class="info-box">
                        <label>–°—Ç–∞—Ç—É—Å</label>
                        <div class="value" id="status">–ì–û–¢–û–í</div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="panel">
                    <h3>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                    <div class="controls-panel">
                        <button onclick="startGame()">‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç</button>
                        <button onclick="pauseGame()" class="secondary">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
                        <button onclick="resetGame()" class="secondary">‚Üª –°–±—Ä–æ—Å</button>
                        <button onclick="showDifficultyModal()" class="secondary">üìä –£—Ä–æ–≤–µ–Ω—å</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>üéÆ –ß–∏—Ç—ã</h3>
                    <div class="cheats-panel">
                        <div class="cheat-item">
                            <label>
                                <input type="checkbox" id="cheat-immortality" onchange="updateCheats()">
                                <span>–ë–µ—Å—Å–º–µ—Ä—Ç–∏–µ</span>
                            </label>
                            <div class="cheat-description">–ù–µ –º–æ–∂–µ—à—å —É–º–µ—Ä–µ—Ç—å</div>
                        </div>

                        <div class="cheat-item">
                            <label>
                                <input type="checkbox" id="cheat-slow-mo" onchange="updateCheats()">
                                <span>Slow Motion</span>
                            </label>
                            <input type="range" id="cheat-slow-mo-val" min="0.1" max="1" step="0.1" value="0.5" onchange="updateCheats()">
                            <div class="cheat-description">–ó–∞–º–µ–¥–ª–µ–Ω–∏–µ –∏–≥—Ä—ã</div>
                        </div>

                        <div class="cheat-item">
                            <label>
                                <input type="checkbox" id="cheat-infinite-food" onchange="updateCheats()">
                                <span>–ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –µ–¥–∞</span>
                            </label>
                            <div class="cheat-description">–ï–¥–∞ –≤–µ–∑–¥–µ –Ω–∞ –∫–∞—Ä—Ç–µ</div>
                        </div>

                        <div class="cheat-item">
                            <label>
                                <input type="checkbox" id="cheat-length-boost" onchange="updateCheats()">
                                <span>–£—Å–∏–ª–∏—Ç–µ–ª—å –¥–ª–∏–Ω—ã</span>
                            </label>
                            <input type="number" id="cheat-length-val" min="1" max="50" value="10" onchange="updateCheats()" style="margin-top: 5px;">
                            <div class="cheat-description">–ö–æ–ª-–≤–æ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∑–∞ –µ–¥—É</div>
                        </div>

                        <div class="cheat-item">
                            <label>
                                <input type="checkbox" id="cheat-speed-hack" onchange="updateCheats()">
                                <span>–ö–æ–Ω—Ç—Ä–æ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏</span>
                            </label>
                            <input type="range" id="cheat-speed-val" min="1" max="20" step="1" value="5" onchange="updateCheats()">
                            <div class="cheat-description">–ò–∑–º–µ–Ω—è–π —Å–∫–æ—Ä–æ—Å—Ç—å –∏–≥—Ä—ã</div>
                        </div>

                        <div class="cheat-item">
                            <label>
                                <input type="checkbox" id="cheat-vision" onchange="updateCheats()">
                                <span>–†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –∑—Ä–µ–Ω–∏–µ</span>
                            </label>
                            <div class="cheat-description">–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å—é –µ–¥—É –Ω–∞ –∫–∞—Ä—Ç–µ</div>
                        </div>

                        <div class="cheat-item">
                            <label>
                                <input type="checkbox" id="cheat-wall-pass" onchange="updateCheats()">
                                <span>–ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å—Ç–µ–Ω</span>
                            </label>
                            <div class="cheat-description">–ü—Ä–æ—Ö–æ–¥–∏ —Å–∫–≤–æ–∑—å –≥—Ä–∞–Ω–∏—Ü—ã</div>
                        </div>

                        <div class="cheat-item">
                            <label>
                                <input type="checkbox" id="cheat-size-control" onchange="updateCheats()">
                                <span>–ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–∞–∑–º–µ—Ä–∞</span>
                            </label>
                            <input type="number" id="cheat-size-val" min="3" max="100" value="20" onchange="updateCheats()">
                            <div class="cheat-description">–£—Å—Ç–∞–Ω–æ–≤–∏ —Å–≤–æ—é –¥–ª–∏–Ω—É</div>
                        </div>

                        <div class="cheat-item">
                            <label>
                                <input type="checkbox" id="cheat-score-mult" onchange="updateCheats()">
                                <span>–ú–Ω–æ–∂–∏—Ç–µ–ª—å –æ—á–∫–æ–≤</span>
                            </label>
                            <input type="range" id="cheat-score-mult-val" min="1" max="100" step="5" value="1" onchange="updateCheats()">
                            <div class="cheat-description">–£—Å–∏–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤</div>
                        </div>
                    </div>
                </div>

                <div class="panel stats-panel">
                    <h3>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="stat-row">
                        <span class="stat-label">–°—ä–µ–¥–µ–Ω–æ:</span>
                        <span class="stat-value" id="stat-food">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">–í—Ä–µ–º—è:</span>
                        <span class="stat-value" id="stat-time">0—Å</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">–†–µ–∫–æ—Ä–¥:</span>
                        <span class="stat-value" id="stat-record">0</span>
                    </div>
                </div>

                <div class="panel">
                    <h3>‚å®Ô∏è –ö–ª–∞–≤–∏—à–∏</h3>
                    <div class="controls-info">
                        <strong>–°—Ç—Ä–µ–ª–∫–∏</strong> –∏–ª–∏ <strong>WASD</strong> - –¥–≤–∏–∂–µ–Ω–∏–µ<br>
                        <strong>–ü—Ä–æ–±–µ–ª</strong> - –ø–∞—É–∑–∞<br>
                        <strong>R</strong> - —Å–±—Ä–æ—Å<br>
                        <strong>–ú—ã—à—å</strong> - —Ç–æ—á–∫–∞ –¥–ª—è —â–µ–ª—á–∫–∞
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>üéÆ –ò—Å–ø–æ–ª—å–∑—É–π —á–∏—Ç—ã –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ | –†–µ–∫–æ—Ä–¥—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —á–∏—Ç–∞–º–∏</p>
        </div>
    </div>

    <div class="modal" id="difficultyModal">
        <div class="modal-content">
            <h2>üéØ –í—ã–±–µ—Ä–∏ –£—Ä–æ–≤–µ–Ω—å</h2>
            <div class="difficulty-buttons">
                <button onclick="setDifficulty(1)">–õ–µ–≥–∫–æ</button>
                <button onclick="setDifficulty(2)">–ù–æ—Ä–º–∞–ª—å–Ω–æ</button>
                <button onclick="setDifficulty(3)">–°–ª–æ–∂–Ω–æ</button>
                <button onclick="setDifficulty(4)">–ê–¥—Å–∫–∏–π</button>
            </div>
            <button onclick="closeDifficultyModal()" class="secondary" style="margin-top: 15px; width: 100%;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        // Game Variables
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let snake = [{x: 400, y: 250}];
        let food = [];
        let score = 0;
        let gameRunning = false;
        let gamePaused = false;
        let direction = {x: 1, y: 0};
        let nextDirection = {x: 1, y: 0};
        let gridSize = 20;
        let gameSpeed = 5;
        let foodEaten = 0;
        let gameStartTime = 0;
        let maxScore = localStorage.getItem('snakeMaxScore') || 0;
        let difficulty = 2;

        // Cheat Variables
        let cheats = {
            immortality: false,
            slowMo: false,
            slowMoValue: 0.5,
            infiniteFood: false,
            lengthBoost: false,
            lengthBoostValue: 10,
            speedHack: false,
            speedHackValue: 5,
            vision: false,
            wallPass: false,
            sizeControl: false,
            sizeControlValue: 20,
            scoreMultiplier: false,
            scoreMultiplierValue: 1
        };

        // Difficulty Settings
        const difficultySettings = {
            1: { speed: 3, foodCount: 2 },
            2: { speed: 5, foodCount: 3 },
            3: { speed: 8, foodCount: 5 },
            4: { speed: 12, foodCount: 8 }
        };

        function updateCheats() {
            cheats.immortality = document.getElementById('cheat-immortality').checked;
            cheats.slowMo = document.getElementById('cheat-slow-mo').checked;
            cheats.slowMoValue = parseFloat(document.getElementById('cheat-slow-mo-val').value);
            cheats.infiniteFood = document.getElementById('cheat-infinite-food').checked;
            cheats.lengthBoost = document.getElementById('cheat-length-boost').checked;
            cheats.lengthBoostValue = parseInt(document.getElementById('cheat-length-val').value);
            cheats.speedHack = document.getElementById('cheat-speed-hack').checked;
            cheats.speedHackValue = parseInt(document.getElementById('cheat-speed-val').value);
            cheats.vision = document.getElementById('cheat-vision').checked;
            cheats.wallPass = document.getElementById('cheat-wall-pass').checked;
            cheats.sizeControl = document.getElementById('cheat-size-control').checked;
            cheats.sizeControlValue = parseInt(document.getElementById('cheat-size-val').value);
            cheats.scoreMultiplier = document.getElementById('cheat-score-mult').checked;
            cheats.scoreMultiplierValue = parseInt(document.getElementById('cheat-score-mult-val').value);

            if (cheats.sizeControl && gameRunning) {
                snake.length = cheats.sizeControlValue;
                while (snake.length < cheats.sizeControlValue) {
                    snake.push({...snake[snake.length - 1]});
                }
            }
        }

        function showDifficultyModal() {
            document.getElementById('difficultyModal').classList.add('active');
        }

        function closeDifficultyModal() {
            document.getElementById('difficultyModal').classList.remove('active');
        }

        function setDifficulty(level) {
            difficulty = level;
            gameSpeed = difficultySettings[level].speed;
            document.getElementById('level').textContent = ['–õ–µ–≥–∫–æ', '–ù–æ—Ä–º–∞–ª—å–Ω–æ', '–°–ª–æ–∂–Ω–æ', '–ê–¥—Å–∫–∏–π'][level - 1];
            closeDifficultyModal();
        }

        function startGame() {
            if (!gameRunning) {
                gameRunning = true;
                gamePaused = false;
                gameStartTime = Date.now();
                document.getElementById('status').textContent = '–ò–ì–†–ê';
                gameLoop();
            }
        }

        function pauseGame() {
            if (gameRunning) {
                gamePaused = !gamePaused;
                document.getElementById('status').textContent = gamePaused ? '–ü–ê–£–ó–ê' : '–ò–ì–†–ê';
                if (!gamePaused) {
                    gameLoop();
                }
            }
        }

        function resetGame() {
            snake = [{x: 400, y: 250}];
            food = [];
            score = 0;
            foodEaten = 0;
            gameRunning = false;
            gamePaused = false;
            direction = {x: 1, y: 0};
            nextDirection = {x: 1, y: 0};
            document.getElementById('score').textContent = '0';
            document.getElementById('length').textContent = '3';
            document.getElementById('status').textContent = '–ì–û–¢–û–í';
            document.getElementById('stat-food').textContent = '0';
            draw();
        }

        function spawnFood() {
            if (cheats.infiniteFood) {
                food = [];
                for (let i = 0; i < 20; i++) {
                    food.push({
                        x: Math.floor(Math.random() * (canvas.width / gridSize)) * gridSize,
                        y: Math.floor(Math.random() * (canvas.height / gridSize)) * gridSize
                    });
                }
            } else {
                let foodCount = difficultySettings[difficulty].foodCount;
                while (food.length < foodCount) {
                    let newFood = {
                        x: Math.floor(Math.random() * (canvas.width / gridSize)) * gridSize,
                        y: Math.floor(Math.random() * (canvas.height / gridSize)) * gridSize
                    };
                    if (!food.some(f => f.x === newFood.x && f.y === newFood.y)) {
                        food.push(newFood);
                    }
                }
            }
        }

        function update() {
            if (!gameRunning || gamePaused) return;

            direction = nextDirection;

            let head = {x: snake[0].x + direction.x * gridSize, y: snake[0].y + direction.y * gridSize};

            // Wall pass cheat
            if (cheats.wallPass) {
                head.x = (head.x + canvas.width) % canvas.width;
                head.y = (head.y + canvas.height) % canvas.height;
            }

            // Check collision with walls
            if (!cheats.wallPass && (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height)) {
                if (!cheats.immortality) {
                    endGame();
                    return;
                } else {
                    head.x = (head.x + canvas.width) % canvas.width;
                    head.y = (head.y + canvas.height) % canvas.height;
                }
            }

            // Check collision with self
            for (let segment of snake) {
                if (head.x === segment.x && head.y === segment.y) {
                    if (!cheats.immortality) {
                        endGame();
                        return;
                    }
                }
            }

            snake.unshift(head);

            // Check food collision
            let foodIndex = food.findIndex(f => f.x === head.x && f.y === head.y);
            if (foodIndex !== -1) {
                food.splice(foodIndex, 1);
                foodEaten++;
                
                let points = cheats.scoreMultiplier ? 10 * cheats.scoreMultiplierValue : 10;
                score += points;
                
                if (cheats.lengthBoost) {
                    for (let i = 0; i < cheats.lengthBoostValue; i++) {
                        snake.push({...snake[snake.length - 1]});
                    }
                } else {
                    // Normal food gives 1 segment
                }
                
                document.getElementById('score').textContent = score;
                document.getElementById('length').textContent = snake.length;
                document.getElementById('stat-food').textContent = foodEaten;
            } else {
                snake.pop();
            }

            if (food.length < difficultySettings[difficulty].foodCount) {
                spawnFood();
            }
        }

        function draw() {
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw grid
            ctx.strokeStyle = 'rgba(0, 255, 136, 0.05)';
            ctx.lineWidth = 0.5;
            for (let i = 0; i <= canvas.width; i += gridSize) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i <= canvas.height; i += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }

            // Draw food
            if (cheats.vision) {
                ctx.fillStyle = 'rgba(255, 100, 100, 0.3)';
                food.forEach(f => {
                    ctx.fillRect(f.x, f.y, gridSize, gridSize);
                });
            }
            
            ctx.fillStyle = '#ff4444';
            food.forEach(f => {
                ctx.beginPath();
                ctx.arc(f.x + gridSize / 2, f.y + gridSize / 2, gridSize / 2.5, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = '#ff8888';
                ctx.lineWidth = 2;
                ctx.stroke();
            });

            // Draw snake
            snake.forEach((segment, index) => {
                if (index === 0) {
                    // Head
                    ctx.fillStyle = '#00ff88';
                    ctx.fillRect(segment.x, segment.y, gridSize, gridSize);
                    ctx.strokeStyle = '#00ffaa';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(segment.x, segment.y, gridSize, gridSize);
                    
                    // Eyes
                    ctx.fillStyle = '#000';
                    let eyeX = direction.x !== 0 ? (direction.x > 0 ? gridSize - 5 : 5) : gridSize / 2;
                    let eyeY = direction.y !== 0 ? (direction.y > 0 ? gridSize - 5 : 5) : gridSize / 2;
                    ctx.fillRect(segment.x + eyeX - 2, segment.y + eyeY - 2, 4, 4);
                } else {
                    // Body
                    ctx.fillStyle = index % 3 === 0 ? '#00dd77' : '#00cc66';
                    ctx.fillRect(segment.x + 1, segment.y + 1, gridSize - 2, gridSize - 2);
                    ctx.strokeStyle = '#00ff88';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(segment.x + 1, segment.y + 1, gridSize - 2, gridSize - 2);
                }
            });

            // Draw immortality indicator
            if (cheats.immortality && gameRunning) {
                ctx.fillStyle = 'rgba(0, 255, 136, 0.3)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
        }

        function endGame() {
            gameRunning = false;
            document.getElementById('status').textContent = '–ö–û–ù–ï–¶';
            
            if (score > maxScore && !Object.values(cheats).some(v => v === true)) {
                maxScore = score;
                localStorage.setItem('snakeMaxScore', maxScore);
            }
            document.getElementById('stat-record').textContent = maxScore;
        }

        function gameLoop() {
            if (!gamePaused && gameRunning) {
                let actualSpeed = cheats.speedHack ? cheats.speedHackValue : gameSpeed;
                let speedMultiplier = cheats.slowMo ? cheats.slowMoValue : 1;
                
                setTimeout(() => {
                    update();
                    draw();
                    gameLoop();
                }, (1000 / actualSpeed) * speedMultiplier);
            } else if (gameRunning) {
                draw();
                requestAnimationFrame(gameLoop);
            }
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            switch(e.key.toUpperCase()) {
                case 'ARROWUP':
                case 'W':
                    if (direction.y === 0) nextDirection = {x: 0, y: -1};
                    break;
                case 'ARROWDOWN':
                case 'S':
                    if (direction.y === 0) nextDirection = {x: 0, y: 1};
                    break;
                case 'ARROWLEFT':
                case 'A':
                    if (direction.x === 0) nextDirection = {x: -1, y: 0};
                    break;
                case 'ARROWRIGHT':
                case 'D':
                    if (direction.x === 0) nextDirection = {x: 1, y: 0};
                    break;
                case ' ':
                    pauseGame();
                    break;
                case 'R':
                    resetGame();
                    break;
            }
        });

        // Mouse control
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            const headX = snake[0].x;
            const headY = snake[0].y;

            const dx = mouseX - headX;
            const dy = mouseY - headY;

            if (Math.abs(dx) > Math.abs(dy)) {
                if (dx > 0 && direction.x === 0) nextDirection = {x: 1, y: 0};
                if (dx < 0 && direction.x === 0) nextDirection = {x: -1, y: 0};
            } else {
                if (dy > 0 && direction.y === 0) nextDirection = {x: 0, y: 1};
                if (dy < 0 && direction.y === 0) nextDirection = {x: 0, y: -1};
            }
        });

        // Update timer
        setInterval(() => {
            if (gameRunning && !gamePaused) {
                let elapsed = Math.floor((Date.now() - gameStartTime) / 1000);
                document.getElementById('stat-time').textContent = elapsed + '—Å';
            }
        }, 1000);

        // Initialize
        setDifficulty(2);
        spawnFood();
        draw();
        document.getElementById('stat-record').textContent = maxScore;
    </script>
</body>
</html>
